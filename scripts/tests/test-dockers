# -*- shell-script -*-

period=3

echo BEGIN - $(date)

if [[ -z "$@" ]]; then
    students="mary lisa bill john kurt mick rosy jack pete jose"
elif [[ "$#" == 2 ]]; then
    from=$1; shift
    to=$1
    students=""
    for nb in $(seq $from $to); do
	students="$students $(printf stud-%04d $nb)"
    done
else
    students="$@"
fi

root=/nbhosting
course=flotbioinfo
notebook=w1/fr-w1-s07-c1-walking.ipynb
image=jupyter/scipy-notebook

# create one every <period> s
port=$start
for student in $students; do
    port=$(python3 ../../django/ports/ports.py 1)
    echo ========== "$student -> $port (period=$period)"
    nbh-enroll-student-in-course $root $student $course
    nbh-run-student-course-jupyter $root $student $course $notebook $image $port >& $student.log &
    sleep $period
done

echo END - $(date)
