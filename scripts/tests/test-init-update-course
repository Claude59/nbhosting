#/bin/bash -x

root=/nbhosting-test
course=flotbioinfo
giturl=https://github.com/parmentelat/flotbioinfo.git

log=$root/logs/$course/update-course.log

function init() {
    echo ++++++++++++++++++++ cleaning up $root
    rm -rf $root	
    echo ++++++++++++++++++++ creating git repo
    ./init-course $root $course $giturl
    echo "after init-course"
    ls $root/courses-git/$course
    userdel john
    userdel mary
    # xxx tmp
    ln -s /root/nbhosting-sync/scripts $root
}

function run() {
    echo ++++++++++++++++++++ running update-course
    rm -f $log
    ./update-course $root $course
    cat $log
    
    echo ++++++++++++++++++++ CONTENTS: dirs found in $root except git repo itself
    find $root -type d | grep -v courses-git/$course
    
    echo ++++++++++++++++++++ CONTENTS: nbautoeval in git repo
    ls -l $root/courses-git/$course/nbautoeval
}

# force clean/init phase with the 'init' single arg
[ "$1" == "init" ] && init
run
