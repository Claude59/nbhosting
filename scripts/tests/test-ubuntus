# -*- shell-script -*-

#
# Usage: test-ubuntus [-p period] number-from number-until
#
# as many times as there are integers between <from> and <until>,
# will spawn every <period> seconds a ubuntu container named ubuntu-<i>
#

COMMAND=$(basename $0)

#################### globals
image=ubuntu
period=10

####################

function usage() {
    echo "Usage: $COMMAND [-p period] [-i image] from until"
    echo "create a ubuntu container for all <i>s in the range <from> .. <until>"
    exit 1
}

# parse args
while getopts ":p:i:" opt; do
    case $opt in
	p)  period=$OPTARG ;;
	i)  image=$OPTARG ;;
	\?) echo "Invalid option: -$OPTARG" >&2; exit 1 ;;
	:)  echo "Option -$OPTARG requires an argument." >&2 ; exit 1 ;;
  esac
done
shift $((OPTIND-1))

from=$1 ; shift
to=$1; shift

[ -n "$from" -a -n "$to" ] || usage
[[ -z "$@" ]] || usage

contnames=""
for nb in $(seq $from $to); do
    contnames="$contnames $(printf $image-%04d $nb | sed -e 's,/,-,') "
done

echo $0 BEGIN - $(date)

# create one every <period> s
for contname in $contnames; do
    echo "=== $(date) period=$period; dealing with $contname"
    docker run --name $contname -dit $image
    sleep $period
done

echo $0 END - $(date)
